function showInfo(a, e) {
    Papa.parse("../../data/dataset.csv", {
              download:true,
              header:true,
              complete:function(results) {
                    allRows = results.data;
                     var t = new URI,
                     n = t.search(!0);
                     if (n) {
                        var i = [];
                        i.push(buildDepartmentFilter(n.city)), i.push(buildDatatypeFilter(n.datatype)), updateCards(allRows, _.compact(i))
                     } else updateCards(allRows)
                               }
                     });
   
}

function updateCards(a, e) {
    var e = e || [],
        t = $("#card-template").html(),
        n = Handlebars.compile(t);
    _.chain(a).filter(function(a) {
        return _.all(e, function(e) {
            return e(a)
        })
   }).map(function(a) {
        console.log(a);
        a.free = a["Data is freely available online"], a.machine = a["Data is machine readable"], a.context = a["Context is provided"], a.bulk = a["Available in bulk"], a.fresh = a["Up-to-date"], a.incident = a["Incident-level data"], a.freeCaption = captions.free[a.free], a.machineCaption = captions.machine[a.machine], a.contextCaption = captions.context[a.context], a.bulkCaption = captions.bulk[a.bulk], a.freshCaption = captions.fresh[a.fresh], a.incidentCaption = captions.incident[a.incident];
        a.linktxt =  URI.withinString(a["Link"], function(url) {
                                            return "<a href='" + url+"'>"+ url + "</a>";
                                        });
        var e = n(a);
        $("#cards").append(e), $('[data-toggle="tooltip"]').tooltip()
    })
}

function buildDepartmentFilter(a) {
    return a ? function(e) {
        return e["City"] === a
    } : !1
}

function buildDatatypeFilter(a) {
    return a ? function(e) {
        return e["Data"] === a
    } : !1
}

function clearCards() {
    $("#cards").empty()
}

function filterByDepartment(a) {
    clearCards(), updateCards(allRows, [buildDepartmentFilter(a)])
}

function resetSearch() {
    clearCards(), updateCards(allRows)
}

function filterByDatatype(a) {
    clearCards(), updateCards(allRows, [buildDatatypeFilter(a)])
}

function filterByMachineReadable(a) {
    clearCards(), updateCards(_.filter(allRows, function(e) {
        return a ? "Yes" === e["Data is machine readable"] : "No" === e["Data is machine readable"]
    }))
}
$(document).ready(function() {
    showInfo();
});
var allRows = [];